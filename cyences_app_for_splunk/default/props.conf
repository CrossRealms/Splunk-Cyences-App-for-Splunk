[cyences:notable:events]
TRUNCATE = 0
REPORT-1 = cyences_alert_extract
KV_MODE = none
DATETIME_CONFIG = CURRENT
EVAL-orig_dest = dest
EVAL-orig_dvc = dvc
EVAL-orig_src = src
EVAL-orig_src_user = src_user
EVAL-orig_user = user
EVAL-dest = if(isnotnull(category), null(), dest)
EVAL-dvc = if(isnotnull(category), null(), dvc)
EVAL-src = if(isnotnull(category), null(), src)
EVAL-src_user = if(isnotnull(category), null(), src_user)
EVAL-user = if(isnotnull(category), null(), user)
EVAL-timestamp = if(timestamp=="none",null(), timestamp)
EVAL-category = rtrim(mvindex(split(search_name, "-"),0))
FIELDALIAS-alert_name = search_name as alert_name
EVAL-cyences_severity = if(isnotnull(cyences_severity), cyences_severity, "medium")
LOOKUP-zu-asset_lookup_by_str-dest = 
LOOKUP-zu-asset_lookup_by_str-dvc = 
LOOKUP-zu-asset_lookup_by_str-src = 
LOOKUP-zv-asset_lookup_by_cidr-dest = 
LOOKUP-zv-asset_lookup_by_cidr-dvc = 
LOOKUP-zv-asset_lookup_by_cidr-src = 
LOOKUP-zy-identity_lookup_expanded-src_user = 
LOOKUP-zy-identity_lookup_expanded-user = 
LOOKUP-zz-asset_lookup_default_fields-dest = 
LOOKUP-zz-asset_lookup_default_fields-dvc = 
LOOKUP-zz-asset_lookup_default_fields-src = 
LOOKUP-zz-identity_lookup_default_fields-src_user = 
LOOKUP-zz-identity_lookup_default_fields-user = 

[source::.../var/log/splunk/cyences_*.log*]
SHOULD_LINEMERGE = false
LINE_BREAKER = ([\r\n]+)\d{4}-\d{2}-\d{2}
sourcetype = cyences:logs
TRUNCATE = 20000

[source::XmlWinEventLog:Microsoft-Windows-Windows Defender/Operational]
EVAL-AVSignature_version = coalesce(AVSignature_version, AV_security_intelligence_version)
EVAL-AV_signature_creation_time = coalesce(AV_signature_creation_time, AV_security_intelligence_creation_time)

[source::WinEventLog:Microsoft-Windows-Windows Defender/Operational]
EVAL-AVSignature_version = coalesce(AVSignature_version, AV_security_intelligence_version)
EVAL-AV_signature_creation_time = coalesce(AV_signature_creation_time, AV_security_intelligence_creation_time)

[(?::){0}kaspersky*]
EXTRACT-dst = ^.+dst\=(?P<dst>[\w\.\-]+)
EXTRACT-dhost = ^.+dhost\=(?P<dest>[\w\-]+)
REPORT-kaspersky_fieldextract = kaspersky_fieldextract
EXTRACT-msgfield = msg=(?<msg>.*)rt=\d+

[o365:management:activity]
EVAL-action = case(isnotnull(action),action,(Operation == "UserLoginFailed"),"failure",(Operation == "UserLoggedIn"),"success")

[pan:globalprotect]
EVAL-src = coalesce(src, src_ip)
EVAL-action = coalesce(action, status)
EVAL-dest_category = if((log_subtype="login" AND (event_id="portal-auth" OR event_id="gateway-auth") AND (action="failure" OR status="failure")) OR (log_subtype="connected" AND event_id="gateway-connected" AND (action="success" OR status="success")), "vpn_auth", dest_category)
EVAL-dest = coalesce(gateway, host)

[pan:system]
EVAL-dest_category = if(log_subtype="globalprotect" AND (event_id="globalprotectportal-auth-fail" OR event_id="globalprotectgateway-auth-fail" OR event_id="globalprotectgateway-regist-succ"), "vpn_auth", dest_category)

[fgt_event]
EVAL-dest_category = if(subtype="vpn" AND vendor_action IN ("tunnel-up", "phase2-up", "ssl-login-fail"), "vpn_auth", dest_category)

[fortigate_event]
EVAL-dest_category = if(subtype="vpn" AND vendor_action IN ("tunnel-up", "phase2-up", "ssl-login-fail"), "vpn_auth", dest_category)

[cisco:ise:syslog]
EVAL-dest_category = if(MESSAGE_CODE IN (5400, 5401) AND isnotnull(AD_User_Candidate_Identities), "vpn_auth", dest_category)
EVAL-action = "failure"

[cisco:estreamer:data]
FIELDALIAS-1vendor_user = user AS vendor_user
EVAL-user = username
EVAL-dest_category = if(rec_type_desc="New VPN Device Login", "vpn_auth", dest_category)
EVAL-action = case(rec_type_desc="New VPN Device Login", "success", fw_rule_action="Allow","allowed", like(fw_rule_action,"%Block%"), "blocked", 1=1, action)
EVAL-src_ip = if(rec_type_desc="New VPN Device Login" OR rec_type_desc="New VPN Device Logoff", client_ip, src_ip)
EVAL-src = if(rec_type_desc="New VPN Device Login" OR rec_type_desc="New VPN Device Logoff", client_ip, src)
EVAL-private_ip = if(rec_type_desc="New VPN Device Login" OR rec_type_desc="New VPN Device Logoff", src_host, private_ip)

[sophos:central:events]
EVAL-user = coalesce(user, suser)
FIELDALIAS-src_ip = "source_info.ip" AS src_ip

[sophos:xg:firewall]
EVAL-action = case(log_subtype="Allowed", "allowed", log_subtype="Denied", "blocked")
EVAL-app = app_name
EVAL-src = src_ip
EVAL-dest = dest_ip
EVAL-packets = packets_out+packets_in

[source::XmlWinEventLog:Security]
EXTRACT-user = <SubjectUserName>(?<user>[^<]+)</SubjectUserName>
EVAL-LogName = if((EventCode=1100 OR EventCode=1102), "Audit-Security", LogName)
EVAL-user = coalesce(User, user, "-")
REPORT-obj_type_from_xml = cs_object_class_as_obj_type
REPORT-obj_dn_from_xml = ObjectDN_as_DN
REPORT-obj_guid_from_xml = ObjectGUID_as_objectGUID
REPORT-obj_old_dn_from_xml = OldObjectDN_as_Old_DN
REPORT-obj_new_dn_from_xml = NewObjectDN_as_New_DN
REPORT-obj_corr_id_from_xml = OpCorrelationID_as_Correlation_ID
EVAL-msad_action = if(msad_action=="changed","modified",msad_action)
REPORT-ldap_display_name_from_xml = AttributeLDAPDisplayName_as_LDAP_Display_Name
EXTRACT-cs_obj_dir_src_user_nm = (?si)(?:SubjectUserName\'\>(?!\-)(?<src_user>[^\<]+))
EXTRACT-cs_obj_xml_src_domain = (?si)(?:SubjectDomainName\'\>(?!\-)(?<src_nt_domain>[^\<]+))
EXTRACT-cs_obj_xml_user_nm = (?si)(?:TargetUserName\'\>(?!\-)(?<user>[^\<]+))
EXTRACT-cs_obj_xml_dest_domain = (?si)(?:TargetDomainName\'\>(?!\-)(?<dest_nt_domain>[^\<]+))
EXTRACT-cs_obj_xml_dest_domain_ds = (?si)(?:DSName\'\>(?!\-)(?<dest_nt_domain>[^\.]+)\..*\<)
EXTRACT-cs_obj_xml_user_obj_guid = (?si)(?:(ObjectGUID)\'\>\{(?<user_obj_guid>[^\}]+))\}.*?\'ObjectClass\'\>user\<
EXTRACT-cs_obj_xml_user_obj_dn = (?si)(?:(ObjectDN|NewObjectDN)\'\>(?<user_obj_dn>[^\<]+))\<.*?\'ObjectClass\'\>user\<
EXTRACT-cs_obj_xml_comp_obj_guid = (?si)(?si)(?:(ObjectGUID)\'\>\{(?<computer_obj_guid>[^\}]+))\}.*?\'ObjectClass\'\>computer\<
EXTRACT-cs_obj_xml_comp_obj_dn = (?si)(?:(ObjectDN|NewObjectDN)\'\>(?<computer_obj_dn>[^\<]+))\<.*?\'ObjectClass\'\>computer\<
EXTRACT-cs_obj_xml_group_obj_guid = (?si)(?:(ObjectGUID)\'\>\{(?<group_obj_guid>[^\}]+))\}.*?\'ObjectClass\'\>group\<
EXTRACT-cs_obj_xml_group_obj_dn = (?si)(?:(ObjectDN|NewObjectDN)\'\>(?<group_obj_dn>[^\<]+))\<.*?\'ObjectClass\'\>group\<
EXTRACT-cs_obj_xml_member_obj_dn = (?si)(?:\'ObjectClass\'\>group\<\/Data\>\<Data Name\=\'AttributeLDAPDisplayName\'\>member\<).*(?:\'AttributeValue\'\>)(?<member_obj_dn>[^\<]+)
EXTRACT-cs_obj_xml_ou_obj_guid = (?si)(?:(ObjectGUID)\'\>\{(?<ou_obj_guid>[^\}]+))\}.*?\'ObjectClass\'\>organizationalUnit\<
EXTRACT-cs_obj_xml_ou_obj_dn = (?si)(?:(ObjectDN|NewObjectDN)\'\>(?<ou_obj_dn>[^\<]+))\<.*?\'ObjectClass\'\>organizationalUnit\<
EXTRACT-cs_obj_xml_chg_gp_guid = (?si)(?:AttributeLDAPDisplayName\'\>gPLink).*?cn\=\{(?<chg_gp_guid>[^\}]+)
EXTRACT-cs_obj_xml_gpo_obj_guid = (?si)(?:(ObjectGUID)\'\>\{(?<gpo_obj_guid>[^\}]+))\}.*?\'ObjectClass\'\>groupPolicyContainer\<
EXTRACT-cs_obj_xml_gpo_obj_cn = (?si)(?:(ObjectDN)\'\>CN\=\{(?<Object_Name_Guid>[^\}]+))\}.*?\'ObjectClass\'\>groupPolicyContainer\<
EXTRACT-cs_obj_xml_sourcename = (?msi)\<Provider\sName\=\'(?<SourceName>[^\']+)
EXTRACT-cs_obj_xml_logname_from_channel = (?msi)(?:\<Channel\>)(?<LogName>[^\<]+)
EXTRACT-cs_obj_xml_install_product = (?msi)(?:\>(1033|1042|1040)\<\/EventID\>).*(?:\<EventData\>)\<Data\>(|(?<product_name>[^\<]+))\<\/Data\>\<Data\>(|(?<product_version>[^\<]+))\<\/Data\>\<Data\>(|(?<product_language>[^\<]+))\<\/Data\>\<Data\>(|(?<product_client_id>[^\<]+))\<\/Data\>\<Data\>(|(?<product_manufacturer>[^\<]+))\<\/Data\>\<Data\>
EXTRACT-cs_obj_xml_product_name = (?msi)(?:(\<Application\>|Product|Produkt)(\:|\sName\:))(?<product_name>[^(\<|\.|\-)]+)
EXTRACT-cs_obj_xml_1022_product_info = (?:\>(1022)\<\/EventID\>).*(?:\<EventData\>\<Data\>)(|(?<product_name>[^\<]+))\<\/Data\>\<Data\>(|(?<product_update>[^\<]+))\<\/Data\>
EXTRACT-cs_obj_xml_1035_6_product_info = | rex "(?:\>(1034|1035)\<\/EventID\>).*(?:\<EventData\>\<Data\>)(|(?<product_name>[^\<]+))\<\/Data\>\<Data\>(|(?<product_version>[^\<]+))\<\/Data\>\<Data\>(|(?<product_language>[^\<]+))\<\/Data\>\<Data\>(|(?<product_status>[^\<]+))\<\/Data\>\<Data\>(|(?<product_manufacturer>[^\<]+))
EXTRACT-cs_obj_xml_1005_6_product_name = (?msi)(?:EventCode\=(1005|1006)).*(?:Message\=)(?<product_name>[^\s\-]+)\s\-(?<install_msg>[^$]+)
EXTRACT-cs_obj_xml_1036_product_info = (?:\>1036\<\/EventID\>).*(?:\<EventData\>\<Data\>)(|(?<product_name>[^\<]+))\<\/Data\>\<Data\>(|(?<product_version>[^\<]+))\<\/Data\>\<Data\>(|(?<product_language>[^\<]+))\<\/Data\>\<Data\>(|(?<product_update>[^\<]+))\<\/Data\>\<Data\>(|(?<product_status>[^\<]+))\<\/Data\>\<Data\>(|(?<product_manufacturer>[^\<]+))
EXTRACT-cs_obj_xml_nApps = (?:\<nApplications\>)(?<n_apps>[^\<]+)
LOOKUP-cs_obj_changes = cs_ad_audit_change_event_codes EventCode AS EventCode OUTPUTNEW change_action AS msad_action change_category AS change_category obj_type AS obj_type signature AS change_signature
LOOKUP-cs_obj_changes_adv = cs_ad_audit_change_event_codes EventCode AS EventCode obj_type AS obj_type OUTPUTNEW change_action AS msad_action change_category AS change_category obj_type AS obj_type signature AS change_signature
EVAL-user_type = case(match(user,"\$(\,|\@|$)"),"computer",match(user,"SYSTEM|NoGuestsAllowed|ANONYMOUS|NT AUTHORITY|DWM-|LOCAL SERVICE|NETWORK SERVICE"),"system",isnotnull(user),"user")
EVAL-src_user_type = case(match(src_user,"\$(\,|\@|$)"),"computer",match(src_user,"SYSTEM|NoGuestsAllowed|ANONYMOUS|NT AUTHORITY|DWM-|LOCAL SERVICE|NETWORK SERVICE"),"system",isnotnull(src_user),"user")
EVAL-user_obj_email = if(isnull(user_obj_email),if(match(user,"(?=.{1,64}@\S)"),lower(user),if(isnull(User_Principal_Name),NULL,lower(User_Principal_Name))),lower(user_obj_email))
EVAL-dir_svcs_action = if(OperationType="%%14674","Value Added",if(OperationType="%%14675","Value Deleted","Unknown"))
EVAL-member_obj_class = replace(member_obj_class,"^.*\|","")
EVAL-group_obj_ldap_v = if(ObjectClass=="group",LDAP_Display_Name."|".Value,NULL)
EVAL-user_obj_ldap_v = if(ObjectClass=="user",LDAP_Display_Name."|".Value,NULL)
EVAL-gpo_obj_ldap_v = if(ObjectClass=="groupPolicyContainer",LDAP_Display_Name."|".Value,NULL)
EVAL-ou_obj_ldap_v = if(ObjectClass=="organizationalUnit",LDAP_Display_Name."|".Value,NULL)
EVAL-comp_obj_ldap_v = if(ObjectClass=="computer",LDAP_Display_Name."|".Value,NULL)
EVAL-Old_DN = lower(replace(Old_DN,"\x5C{1}",""))
EVAL-New_DN = lower(replace(New_DN,"\x5C{1}",""))
EVAL-DN = lower(replace(DN,"\x5C{1}",""))
EVAL-user_obj_dn = lower(replace(user_obj_dn,"\x5C{1}",""))
EVAL-group_dn = if(ObjectClass="group",lower(replace(ObjectDN,"\x5C{1}","")),lower(replace(group_dn,"\x5C{1}","")))
EVAL-user_group = lower(replace(user_group,"\x5C{1}",""))
EVAL-Group_Name = lower(replace(Group_Name,"\x5C{1}",""))
EVAL-group_obj_dn = lower(replace(group_obj_dn,"\x5C{1}",""))
EVAL-group_obj_id = lower(replace(group_obj_id,"\x5C{1}",""))
EVAL-group_obj_lkp = if(isnull(user_group),if(isnull(Group_Name),if(isnull(group_obj_dn),if(isnull(group_obj_id),if(isnull(group_dn),NULL,lower(replace(group_dn,"\x5C{1}",""))),lower(replace(group_obj_id,"\x5C{1}",""))),lower(replace(group_obj_dn,"\x5C{1}",""))),lower(replace(Group_Name,"\x5C{1}",""))),lower(replace(user_group,"\x5C{1}","")))
EVAL-comp_obj_dn = lower(replace(comp_obj_dn,"\x5C{1}",""))
EVAL-comp_obj_sam = lower(replace(comp_obj_dn,"\x5C{1}",""))
EVAL-ou_obj_dn = lower(replace(ou_obj_dn,"\x5C{1}",""))
EVAL-cn = if(isnull(cn),name,if(match("\x5C{1}",cn),replace(cn,"\x5C{1}",""),cn))
EVAL-distinguishedName = lower(replace(distinguishedName,"\x5C{1}",""))
EVAL-member_obj_dn = lower(replace(member_obj_dn,"\x5C{1}",""))
EVAL-member_obj_sam = if(isnull(member_obj_sam),if(isnull(member_obj_secid),lower(replace(member_obj_dn,"\x5C{1}","")),lower(member_obj_secid)),lower(replace(member_obj_sam,"\x5C{1}","")))
EVAL-member_obj_cn = lower(replace(member_obj_cn,"\x5C{1}",""))
EVAL-member_obj_id = case(isnull(member_obj_sam) AND isnotnull(member_obj_cn),lower(replace(member_obj_cn,"\x5C{1}","")),match(member_obj_sam,"(?i)^CN\="),lower(replace(member_obj_cn,"\x5C{1}","")),isnotnull(member_obj_sam) AND NOT match(member_obj_sam,"(?i)^CN\="),lower(replace(member_obj_sam,"\x5C{1}","")),isnull(member_obj_sam) AND isnull(member_obj_cn),lower(replace(member_obj_dn,"\x5C{1}","")))
EVAL-member_obj_lkp = if(isnull(member_obj_dn),if(isnull(member_obj_cn),if(isnull(member_obj_id),if(isnull(member_obj_sam),NULL,lower(replace(member_obj_sam,"\x5C{1}",""))),lower(replace(member_obj_id,"\x5C{1}",""))),lower(replace(member_obj_cn,"\x5C{1}",""))),lower(replace(member_obj_dn,"\x5C{1}","")))
EVAL-obj_type = lower(obj_type)

[source::WinEventLog:Security]
EVAL-LogName = if((EventCode=1100 OR EventCode=1102), "Audit-Security", LogName)
EVAL-user = coalesce(User, user, "-")
EVAL-SettingType = if(EventCode=4950 AND isnull(SettingType), mvfilter(Type!="Information"), SettingType)
EVAL-SettingValue = if(EventCode=4950 AND isnull(SettingValue), Value, SettingValue)
EVAL-ProfileChanged = if(EventCode=4950 AND isnull(ProfileChanged), Changed_Profile, ProfileChanged)
EXTRACT-cs_obj_src_user = (?msi)(?:Account\s+Name\:(?!\s+(\r|\n))(?!\s+(\-|\r|\n))(?!\s+(\S+\$|\r|\n))(?<src_user>[^(\r|\n)]+))
EXTRACT-cs_obj_user = (?msi)(?:Account\s+Name\:.*?(Account\s+Name\:)|(?:Account\s+Name\:))(?!\s+(\-|\r\n))(?!\s+(\S+\$|\r|\n))\s+(?<user>[^(\r|\n)]+)
EXTRACT-cs_obj_comp_obj_sam = (?msi)(?:Account\s+Name\:.*?(Account\s+Name\:)|(?:Account\s+Name\:))(?!\s+(\-|\r\n))\s+(?<comp_obj_sam>[^(\r|\n)]+)(?<=\$)
EXTRACT-cs_obj_member_Account_Name_secid = (?msi)(?:Member\:)(.*?(Account\sName\:|Security ID:)(\s+(?<member_obj_domain>[^\x5C{1}]+)\x5C{1}|\s+)(?<member_obj_sam>[\S\-\S][^(\r|\n)]+)(\r|\n))
EXTRACT-cs_obj_member_obj_dn = (?msi)(?:Member\:).*?(Account\s+Name\:\s+(?<member_obj_dn>CN\=[^(\r|\n)]+))
EXTRACT-cs_obj_member_obj_cn_val = (?msi)(?:LDAP Display Name\:\s+member)(.*?Value\:)\s+CN=(?<member_obj_cn>.+?)(?<!\\),(?:(?:OU|CN|DC).+?(?<!\\),)+(DC.+?)(\s+|\n|\r)
EXTRACT-cs_obj_group_secid = (?msi)(?:New\sGroup\:|Group\:)(\s|\r|\n)(.*?Security ID:(\s+(?<group_obj_domain>[^\x5C{1}]+)\x5C{1}|\s+)(?<group_obj_id>[\S\-\S][^(\r|\n)]+)(\r|\n))
EXTRACT-cs_obj_group_nm_domain = (?msi)Group\:(\s|\r|\n)(.*?Group\sName\:\s+(?<group_obj_nm>[\S\-\S][^(\r|\n)]+)(\r|\n))(.*?Group\sDomain\:\s+(?<group_obj_domain>[\S\-\S][^(\r|\n)]+)(\r|\n))
EXTRACT-cs_obj_group_name_secid = (?msi)(?:New\sGroup\:|Group\:)(\s|\r|\n)(.*?Security ID:(\s+(?<group_obj_domain>[^\x5C{1}]+)\x5C{1}|\s+)(?<group_obj_id>[\S\-\S][^(\r|\n)]+)(\r|\n))
EXTRACT-cs_obj_src_nt_domain_Account_Domain = (?msi)(?:Account\s+Domain\:(?!\s+(\r|\n))\s+(?<src_nt_domain>[a-zA-Z0-9._[\S\-\S][^\r|\n]+))
EXTRACT-cs_obj_src_ip_Source_Network_Address = (?msi)Source Network Address:\s+?(?<src_ip>[^\n]+)
EXTRACT-cs_obj_dest_nt_domain_Account_Domain = (?msi)(Account\s+Domain\:.*?(Account\s+Domain\:)|Account\s+Domain\:)(?!\s+(\r|\n))\s+(?<dest_nt_domain>[a-zA-Z0-9._[\S\-\S][^\r|\n]+)
EXTRACT-cs_obj_dest_nt_domain_Group_Domain = (?msi)(Group\s+Domain\:.*?(Group\s+Domain\:)|Group\s+Domain\:)(?!\s+(\r|\n))\s+(?<dest_nt_domain>[a-zA-Z0-9._[\S\-\S][^\r|\n]+)
EXTRACT-cs_obj_objectGUID_GUID = GUID\:\s+\{(?<obj_GUID>[^\}]+)
EXTRACT-cs_obj_session_id = (?msi)(Logon\s+ID\:.*?(Logon\s+ID\:)|Logon\s+ID\:)(?!\s+(\r|\n))\s+(?<session_id>[a-zA-Z0-9._[\S\-\S][^\r|\n]+)
EXTRACT-cs_obj_object_type_group = (?msi)(?:Object Type\:\s+group(\s+|\n|\r).*?(Object\sName|DN)\:\s+(?<group_obj_dn>[^(\r|\n)]+))
EXTRACT-cs_obj_object_type_user = (?msi)(?:Object Type\:\s+user(\s+|\n|\r).*?(Object\sName|DN)\:\s+(?<user_obj_dn>[^(\r|\n)]+))
EXTRACT-cs_obj_object_type_ou = (?msi)(?:Object Type\:\s+organizationalUnit(\s+|\n|\r).*?(Object\sName|DN)\:\s+(?<ou_obj_dn>[^(\r|\n)]+))
EXTRACT-cs_obj_object_type_gpo = (?msi)(?:Object Type\:\s+groupPolicyContainer(\s+|\n|\r).*?(Object\sName|DN)\:\s+(?<gpo_obj_dn>[^(\r|\n)]+))
EXTRACT-cs_obj_object_type_computer = (?msi)(?:Object Type\:\s+computer(\s+|\n|\r).*?(Object\sName|DN)\:\s+(?<comp_obj_dn>[^(\r|\n)]+))
EXTRACT-cs_obj_type_class = (?msi)(?:Object(\sType\:|\:))(\s+|\n|\r)(?:.*Class\:)\s+(?<obj_type>[^(\r|\n)]+)
EXTRACT-cs_obj_type_only = (?msi)(?:Object Type\:(?!\s+(\r|\n))\s+(?<obj_type>[^(\r|\n)]+))
EXTRACT-cs_obj_type_taskcat = (?msi)(?:TaskCategory\=)(\s|)(Security|)(?<obj_type>[^\s]+)(\sAccount\s|\s)Management
EXTRACT-cs_obj_type_action = (?msi)(?:Message=A)\s(?<obj_type>[^\s]+)\s(account|type)\swas\s(?<msad_action>[^(\.|\s)]+)
EXTRACT-cs_obj_type_member = (?msi)(?:Message=A)\s+member\s+was\s+(?<msad_action>\S+)\s+(to|from)\s+a\s+(?<MSADGroupClass>\S+)\-(?<MSADGroupClassID>(enabled|disabled))\s(?<MSADGroupType>(\S+|\S+\s\S+))\s+(?<obj_type>group)\.
EXTRACT-cs_obj_type_group = (?msi)(?:Message=A)\s+(?<MSADGroupClass>\S+)\-(?<MSADGroupClassID>(enabled|disabled))\s(?<MSADGroupType>(\S+|\S+\s\S+))\s(?<obj_type>group)\swas\s(?<msad_action>[^\.]+)\.
EXTRACT-cs_obj_dir_svcs_user_obj_dn = (?msi)(?:Object\:)(.*?DN\:\s+)(?<user_obj_dn>[^\r|\n]+)(.*?Class\:\s+user)
EXTRACT-cs_obj_dir_svcs_comp_obj_dn = (?msi)(?:Object\:)(.*?DN\:\s+)(?<comp_obj_dn>[^\r|\n]+)(.*?Class\:\s+computer)
EXTRACT-cs_obj_dir_svcs_group_obj_dn = (?msi)(?:Object\:)(.*?DN\:\s+)(?<group_obj_dn>[^\r|\n]+)(.*?Class\:\s+group)(\r|\n)
EXTRACT-cs_obj_dir_svcs_gpo_obj_dn = (?msi)(?:Object\:)(.*?DN\:\s+)(?<gpo_obj_dn>[^\r|\n]+)(.*?Class\:\s+groupPolicyContainer)(\r|\n)
EXTRACT-cs_obj_dir_svcs_ou_obj_dn = (?msi)(?:Object\:)(.*?DN\:\s+)(?<ou_obj_dn>[^\r|\n]+)(.*?Class\:\s+organizationalUnit)
EXTRACT-cs_obj_dir_svcs_changes_object_guid = (?msi)(Object Type\:|Object\:)(\s+|\n|\r).*(Object\sName|DN)\:\s+CN(=\"|=\{)(?<Object_Name_Guid>[^(\"|\})]+)
EXTRACT-cs_obj_dir_svcs_mb_user_obj_dn = (?msi)(?:LDAP Display Name\:\s+member)(.*?Value\:)\s+(?<member_obj_dn>CN[^(\r|\n)]+)
EXTRACT-cs_obj_dir_svcs_changes_msad_action = (?msi)Message\=A\sdirectory\sservice\sobject\swas\s(?<msad_action>[^\.]+)
REPORT-cs_obj_cs_changed_attributes = cs_obj_cs_changed_attributes_values
EXTRACT-cs_obj_cd_dir_svc_action = (?msi)Operation:(\s|\r|\n).*(?:Type:)\s+(?<dir_svcs_action>[^(\r|\n)]+)
EVAL-user_obj_email = if(isnull(user_obj_email),if(match(user,"(?=.{1,64}@\S)"),lower(user),if(isnull(User_Principal_Name),NULL,lower(User_Principal_Name))),lower(user_obj_email))
EVAL-user_type = case(match(user,"\$(\,|\@|$)"),"computer",match(user,"SYSTEM|NoGuestsAllowed|ANONYMOUS|NT AUTHORITY|DWM-|LOCAL SERVICE|NETWORK SERVICE"),"system",isnotnull(user),"user",isnotnull(comp_obj_sam),"computer")
EVAL-src_user_type = case(match(src_user,"\$(\,|\@|$)"),"computer",match(src_user,"SYSTEM|NoGuestsAllowed|ANONYMOUS|NT AUTHORITY|DWM-|LOCAL SERVICE|NETWORK SERVICE"),"system",isnotnull(src_user),"user",isnotnull(comp_obj_sam),"computer")
EVAL-group_obj_ldap_v = if(Class=="group",LDAP_Display_Name."|".Value,NULL)
EVAL-user_obj_ldap_v = if(Class=="user",LDAP_Display_Name."|".Value,NULL)
EVAL-gpo_obj_ldap_v = if(Class=="groupPolicyContainer",LDAP_Display_Name."|".Value,NULL)
EVAL-ou_obj_ldap_v = if(Class=="organizationalUnit",LDAP_Display_Name."|".Value,NULL)
EVAL-comp_obj_ldap_v = if(Class=="computer",LDAP_Display_Name."|".Value,NULL)
EVAL-MSADChangedAttributes = if(isnotnull(Old_DN),"Object Moved - ########From DN: ".replace(Old_DN,"\x5C{1}","")."########To DN: ".replace(New_DN,"\x5C{1}",""),MSADChangedAttributes)
EVAL-Old_DN = lower(replace(Old_DN,"\x5C{1}",""))
EVAL-New_DN = lower(replace(New_DN,"\x5C{1}",""))
EVAL-DN = lower(replace(DN,"\x5C{1}",""))
EVAL-group_dn = if(ObjectClass="group",lower(replace(ObjectDN,"\x5C{1}","")),lower(replace(group_dn,"\x5C{1}","")))
EVAL-user_obj_dn = lower(replace(user_obj_dn,"\x5C{1}",""))
EVAL-user_group = lower(replace(user_group,"\x5C{1}",""))
EVAL-Group_Name = lower(replace(Group_Name,"\x5C{1}",""))
EVAL-group_obj_dn = lower(replace(group_obj_dn,"\x5C{1}",""))
EVAL-group_obj_id = lower(replace(group_obj_id,"\x5C{1}",""))
EVAL-group_obj_lkp = if(isnull(user_group),if(isnull(Group_Name),if(isnull(group_obj_dn),if(isnull(group_obj_id),if(isnull(group_dn),NULL,lower(replace(group_dn,"\x5C{1}",""))),lower(replace(group_obj_id,"\x5C{1}",""))),lower(replace(group_obj_dn,"\x5C{1}",""))),lower(replace(Group_Name,"\x5C{1}",""))),lower(replace(user_group,"\x5C{1}","")))
EVAL-comp_obj_dn = lower(replace(comp_obj_dn,"\x5C{1}",""))
EVAL-comp_obj_sam = lower(replace(comp_obj_dn,"\x5C{1}",""))
EVAL-ou_obj_dn = lower(replace(ou_obj_dn,"\x5C{1}",""))
EVAL-cn = if(isnull(cn),name,if(match("\x5C{1}",cn),replace(cn,"\x5C{1}",""),cn))
EVAL-distinguishedName = lower(replace(distinguishedName,"\x5C{1}",""))
EVAL-member_obj_dn = lower(replace(member_obj_dn,"\x5C{1}",""))
EVAL-member_obj_sam = if(isnull(member_obj_sam),if(isnull(member_obj_secid),lower(replace(member_obj_dn,"\x5C{1}","")),lower(member_obj_secid)),lower(replace(member_obj_sam,"\x5C{1}","")))
EVAL-member_obj_cn = lower(replace(member_obj_cn,"\x5C{1}",""))
EVAL-member_obj_id = case(isnull(member_obj_sam) AND isnotnull(member_obj_cn),lower(replace(member_obj_cn,"\x5C{1}","")),match(member_obj_sam,"(?i)^CN\="),lower(replace(member_obj_cn,"\x5C{1}","")),isnotnull(member_obj_sam) AND NOT match(member_obj_sam,"(?i)^CN\="),lower(replace(member_obj_sam,"\x5C{1}","")),isnull(member_obj_sam) AND isnull(member_obj_cn),lower(replace(member_obj_dn,"\x5C{1}","")))
EVAL-member_obj_lkp = if(isnull(member_obj_dn),if(isnull(member_obj_cn),if(isnull(member_obj_id),if(isnull(member_obj_sam),NULL,lower(replace(member_obj_sam,"\x5C{1}",""))),lower(replace(member_obj_id,"\x5C{1}",""))),lower(replace(member_obj_cn,"\x5C{1}",""))),lower(replace(member_obj_dn,"\x5C{1}","")))
EVAL-obj_type = lower(obj_type)
LOOKUP-cs_obj_changes = cs_ad_audit_change_event_codes EventCode AS EventCode obj_type AS obj_type OUTPUTNEW change_action AS change_action change_category AS change_category signature AS change_signature

[source::XmlWinEventLog:System]
EXTRACT-logname = </SubjectDomainName><Channel>(?<LogName>[^<]+)</Channel>
EXTRACT-user = <SubjectUserName>(?<user>[^<]+)</SubjectUserName>
EVAL-LogName = if(isnull(LogName), "System", LogName)
EVAL-user = coalesce(User, user, "-")

[source::WinEventLog:System]
EXTRACT-logname = The\s(?<LogName>.+)\slog\sfile\swas\scleared\. in Message
EVAL-LogName = if(isnull(LogName), "System", LogName)
EVAL-user = coalesce(User, user, "-")

[tenable:sc:assets]
EVAL-tenable_uuid = trim(lower(if(isnull(repository_id), "", repository_id).":".if(isnull(ip), "", ip).":".if(isnull(dnsName), "", dnsName)))

[tenable:io:assets]
FIELDALIAS-tenable_uuid = uuid AS tenable_uuid
FIELDALIAS-asset_id = uuid AS asset_id
EVAL-vendor_product = "Tenable.io"
EVAL-asset_hostname = mvjoin(mvdedup(mvappend(fqdns, hostnames, netbios_names)), "~~")
EVAL-asset_ip = mvjoin(mvappend(ipv4s, ipv6s), "~~")
EVAL-asset_mac_address = mvjoin(mac_addresses, "~~")
EVAL-os = operating_systems

[tenable:sc:vuln]
EVAL-tenable_uuid = trim(lower(if(isnull(repository_id), "", repository_id).":".if(isnull(ip), "", ip).":".if(isnull(dnsName), "", dnsName)))
EVAL-vul_id = plugin_id
EVAL-vul_name = plugin_name
EVAL-vul_description = description
EVAL-vul_risk_factor = risk_factor
EVAL-vul_synopsis = synopsis
EVAL-vul_version = plugin_version
EVAL-vul_port = port
EVAL-vul_protocol = protocol
EVAL-vul_severity = severity
EVAL-vul_severity_id = severity_id
EVAL-vul_family = plugin_family
EVAL-vul_type = check_type
EVAL-vul_has_patch = if(patchPubDate=-1, "No", "Yes")
EVAL-vul_state = state
EVAL-vul_cpe = mvjoin(cpe, " ,")
EVAL-vul_cve = mvjoin(cve, " ,")
EVAL-vul_solution = solution

[tenable:io:vuln]
FIELDALIAS-tenable_uuid = asset_uuid AS tenable_uuid
EVAL-vul_id = plugin_id
EVAL-vul_name = plugin_name
EVAL-vul_description = description
EVAL-vul_risk_factor = risk_factor
EVAL-vul_synopsis = synopsis
EVAL-vul_version = plugin_version
EVAL-vul_port = port
EVAL-vul_protocol = protocol
EVAL-vul_severity = severity
EVAL-vul_severity_id = severity_id
EVAL-vul_family = plugin_family
EVAL-vul_type = check_type
EVAL-vul_has_patch = 'plugin.has_patch'
EVAL-vul_in_the_news = 'plugin.in_the_news'
EVAL-vul_state = state
EVAL-vul_cpe = mvjoin(cpe, " ,")
EVAL-vul_cve = mvjoin(cve, " ,")
EVAL-vul_solution = solution
FIELDALIAS-dest_id = asset_uuid as dest_id
FIELDALIAS-dest_name = asset_fqdn AS dest_name
FIELDALIAS-status = state AS status
FIELDALIAS-last_scan_time = scan.completed_at AS last_scan_time
FIELDALIAS-published_time = plugin.publication_date AS published_time
FIELDALIAS-type = plugin.type AS type
EVAL-first_found = strptime(first_found, "%Y-%m-%dT%H:%M:%S.%NZ")
EVAL-last_found = strptime(last_found, "%Y-%m-%dT%H:%M:%S.%NZ")
EVAL-dvc = host

[nessus_json]
FIELDALIAS-tenable_uuid = hid AS tenable_uuid
FIELDALIAS-inventory_fields = "host-ip" AS ip, "host-fqdn" AS fqdns, "netbios-name" AS dnsName, "netbios-name" AS netbios_names, "mac-address" AS mac_addresses, "operating-system" AS operating_systems, host_start AS first_seen, host_end AS last_seen
EVAL-has_agent = if(isnotnull(agent) AND agent!="null", "true", "false")
EVAL-has_plugin_results = if(isnotnull(plugin_id), "true", "false")
FIELDALIAS-vulnerability_fields = plugin_id AS vul_id, plugin_name AS vul_name, description AS vul_description, risk_factor AS vul_risk_factor, synopsis AS vul_synopsis, in_the_news AS vul_in_the_news, plugin_type as vul_type, cpe AS vul_cpe, cve AS vul_cve, solution as vul_solution
EVAL-vul_severity = case(risk_factor=="None", "information", risk_factor=="Low", "low", risk_factor=="Medium", "medium", risk_factor=="High", "high", risk_factor=="Critical", "critical")
EVAL-vul_severity_id = case(risk_factor=="None", 0, risk_factor=="Low", 1, risk_factor=="Medium", 2, risk_factor=="High", 3, risk_factor=="Critical", 4)
EVAL-vul_has_patch = if(isnotnull(patch_publication_date), "true", "false")
EVAL-vul_state = "open"
FIELDALIAS-dest_ip = "host-ip" as dest_ip
FIELDALIAS-dest_name = "host-fqdn" as dest_name
FIELDALIAS-published_time = vuln_publication_date as published_time
FIELDALIAS-os = "operating-system" as os
FIELDALIAS-type = plugin_type AS type
EVAL-first_found = strptime(host_start, "%a %b %d%H:%M:%S %Y")
EVAL-last_found = strptime(host_end, "%a %b %d%H:%M:%S %Y")
EVAL-has_patch = if(isnotnull(patch_publication_date), "true", "false")
EVAL-dest_id = coalesce(hostname,'host-ip')
EVAL-vendor_product = "Nessus"
EVAL-status = "open"
EVAL-dvc = host
FIELDALIAS-asset_mac_address = "mac-address" as asset_mac_address
FIELDALIAS-asset_ip = "host-ip" as asset_ip
FIELDALIAS-agent = agent as asset_type
EVAL-asset_id = coalesce(hostname,'host-ip')
EVAL-asset_hostname = mvjoin(mvappend('host-fqdn', 'netbios-name'), "~~")
EVAL-state = "Active"

[qualys:hostDetection]
FIELDALIAS-dest_id = HOST_ID AS dest_id
FIELDALIAS-vul_id = QID AS vul_id
FIELDALIAS-dest_ip = IP AS dest_ip
FIELDALIAS-os = OS AS os
FIELDALIAS-port = PORT AS port
FIELDALIAS-protocol = PROTOCOL AS protocol
FIELDALIAS-tracking_method = TRACKING_METHOD AS tracking_method
FIELDALIAS-last_scan_time = LAST_SCAN_DATETIME AS last_scan_time
EVAL-first_found = strptime(FIRST_FOUND_DATETIME, "%Y-%m-%dT%H:%M:%S.%NZ")
EVAL-last_found = strptime(LAST_FOUND_DATETIME, "%Y-%m-%dT%H:%M:%S.%NZ")
EVAL-status = case(STATUS="ACTIVE" OR STATUS="NEW", "open", STATUS="RE-OPENED", "reopened", STATUS="FIXED", "fixed")
EVAL-dest_name = mvappend(DNS, NETBIOS)
FIELDALIAS-asset_id = HOST_ID AS asset_id
FIELDALIAS-asset_ip = IP AS asset_ip
EVAL-asset_hostname = mvjoin(mvappend(DNS, NETBIOS), "~~")
EVAL-state = "Active"

[crowdstrike:spotlight:vulnerability:json]
FIELDALIAS-dest_id = falcon_spotlight.aid as dest_id
FIELDALIAS-dest_ip = falcon_spotlight.host_info.local_ip as dest_ip
FIELDALIAS-dest_name = falcon_spotlight.host_info.hostname as dest_name
FIELDALIAS-last_scan_time = falcon_spotlight.updated_timestamp as last_scan_time
FIELDALIAS-vul_id = falcon_spotlight.id as vul_id
FIELDALIAS-published_time = falcon_spotlight.cve.published_date as published_time
FIELDALIAS-description = falcon_spotlight.cve.description as description
FIELDALIAS-os = falcon_spotlight.host_info.os_version as os
FIELDALIAS-status = falcon_spotlight.status as status
FIELDALIAS-severity = falcon_spotlight.cve.severity as severity
FIELDALIAS-cve = falcon_spotlight.cve.id as cve
FIELDALIAS-dvc = host as dvc
EVAL-first_found = strptime('falcon_spotlight.created_timestamp', "%Y-%m-%dT%H:%M:%S.%NZ")
EVAL-last_found = strptime('falcon_spotlight.closed_timestamp', "%Y-%m-%dT%H:%M:%S.%NZ")
EVAL-cvss = mvindex(split(mvindex(split('falcon_spotlight.cve.vector',"/"),0),":"),1)
EVAL-solution = mvjoin('falcon_spotlight.remediation.entities{}.action',":::")
EVAL-has_patch = if(isnotnull('falcon_spotlight.remediation.entities{}.id'), "Yes", "No")
EVAL-vendor_product = "CrowdStrike Spotlight"
FIELDALIAS-asset_id = aid as asset_id
FIELDALIAS-asset_hostname = falcon_spotlight.host_info.hostname as asset_hostname
FIELDALIAS-asset_ip = falcon_spotlight.host_info.local_ip as asset_ip

[crowdstrike:device:json]
FIELDALIAS-asset_id = falcon_device.device_id as asset_id
FIELDALIAS-os = falcon_device.os_version as os
FIELDALIAS-last_scan_time = falcon_device.last_seen as last_scan_time
FIELDALIAS-asset_type = falcon_device.provision_type_desc as asset_type
FIELDALIAS-asset_hostname = falcon_device.hostname as asset_hostname
FIELDALIAS-asset_ip = falcon_device.local_ip as asset_ip
FIELDALIAS-asset_mac_address = falcon_device.mac_address as asset_mac_address
EVAL-vendor_product = "CrowdStrike Devices"

[gapps:report:login]
KV_MODE = json
FIELDALIAS-ipAddr = ipAddress AS src
FIELDALIAS-user = actor.email AS user
FIELDALIAS-sig = events{}.parameters{}.login_type AS signature, events{}.parameters{}.login_type AS login_type
FIELDALIAS-eventname = "events{}.name" as event_name
FIELDALIAS-login_challenge = events{}.parameters{}.login_challenge_method{} as login_challenge_method, events{}.parameters{}.login_challenge_status as challenge_status
EVAL-domain = mvindex(split(source,":"),-1)
EVAL-vendor = "GSuite"
EVAL-action = case('events{}.name'="login_success","success", 'events{}.name'="login_failure","failure", 'events{}.name'="logout","success", match('events{}.parameters{}.login_challenge_status',"Failed"), "failure", true(),"unknown")
EVAL-app = "GSuite login"

[meraki]
EXTRACT-src_ip_extract = src=(?<cyences_src_ip>[^\s]+)
EVAL-src_ip = coalesce(cyences_src_ip, src_ip, srcip)
EVAL-src = coalesce(cyences_src_ip, src, srcip)
EXTRACT-dest_ip_extract = dst=(?<cyences_dest_ip>[^\s]+)
EVAL-dest_ip = coalesce(cyences_dest_ip, dest_ip)
EVAL-dest = coalesce(cyences_dest_ip, dest, dest_ip)

[MSAD:NT6:DNS]
EVAL-message_type = case(direction="Rcv" AND isnull(operation), "QUERY", direction="Snd" AND isnull(operation), "Query to external server", direction="Rcv" AND operation="R", "Response from external server", direction="Snd" AND operation="R", "RESPONSE", 1==1, message_type)
EVAL-query = replace(replace(replace(query, "\(\d+\)$", ""), "^\(\d+\)", ""), "\(\d+\)", ".")
EVAL-record_type = if(questiontype="A", "ANY", questiontype)

[isc:bind:query]
EXTRACT-src_ip_port = client\s+.*\s+(?<src>\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})
EXTRACT-query_and_questiontype = query:\s+(?<query>[^\s]+)\s+IN\s+(?<questiontype>[^\s]+)\s
EVAL-message_type = "QUERY"
EVAL-record_type = if(questiontype="A", "ANY", questiontype)
EVAL-reply_code = "NoError"

[isc:bind:queryerror]
EXTRACT-src_ip_port = client\s+.*\s+(?<src>\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})
EXTRACT-query_and_questiontype_and_reply_code = query\s+failed\s+\((?<reply_code>[^\)]+)\)\s+for\s+(?<query>.+)\/IN\/(?<questiontype>[^\s]+)\s+at\s+
EVAL-message_type = "QUERY"
EVAL-record_type = if(questiontype="A", "ANY", questiontype)
EVAL-reply_code = if(isnull(reply_code), "Error", reply_code)

[source::.../var/log/splunk/cyences__*.log*]
SHOULD_LINEMERGE = false
LINE_BREAKER = ([\r\n]+)\d{4}-\d{2}-\d{2}\s
sourcetype = cyences:logs
TRUNCATE = 100000
TIME_PREFIX = ^
TIME_FORMAT = %Y-%m-%d %H:%M:%S %z

