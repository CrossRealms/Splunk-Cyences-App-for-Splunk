<form theme="dark" version="1.1">
  <label>CrowdStrike</label>
  <init>
    <set token="tkn_product_name_for_data_availability_search">CrowdStrike EventStream</set>
  </init>
  <fieldset submitButton="false">
    <input type="time" token="timeRange">
      <label>Time Range</label>
      <default>
        <earliest>-24h@h</earliest>
        <latest>now</latest>
      </default>
    </input>
  </fieldset>
  <row>
    <panel>
      <html>
        <p>CrowdStrike Reports</p>
        <p><b>Data Collection:</b> Use <a href="https://splunkbase.splunk.com/app/5082/" target="_blank">CrowdStrike Event Stream Add-on</a> for collecting CrowdStrike data.</p>
      </html>
      <table>
        <search>
          <query>$tkn_data_availablity_search$</query>
          <earliest>$timeRange.earliest$</earliest>
          <latest>$timeRange.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
        <format type="color" field="data">
          <colorPalette type="map">{"Data Present": #008000, "Data Not Present": #B83C08}</colorPalette>
        </format>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title>Endpoint Detections</title>
      <input type="multiselect" token="tkn_host">
        <label>Hosts</label>
        <choice value="*">All</choice>
        <default>*</default>
        <prefix>ComputerName IN (</prefix>
        <suffix>)</suffix>
        <valuePrefix>"</valuePrefix>
        <valueSuffix>"</valueSuffix>
        <delimiter>, </delimiter>
        <fieldForLabel>ComputerName</fieldForLabel>
        <fieldForValue>ComputerName</fieldForValue>
        <search>
          <query>`cs_crowdstrike_eventstream` "metadata.eventType" IN ("DetectionSummaryEvent","EppDetectionSummaryEvent") | eval ComputerName = coalesce('event.Hostname','event.ComputerName')  | dedup ComputerName | table ComputerName
          </query>
          <earliest>$timeRange.earliest$</earliest>
          <latest>$timeRange.latest$</latest>
        </search>
      </input>
    </panel>
  </row>
  <row>
    <panel>
      <title>Suspicious Activity or Malware Detected</title>
      <table>
        <search>
          <query>`cs_crowdstrike_eventstream` "metadata.eventType" IN ("DetectionSummaryEvent","EppDetectionSummaryEvent") action="allowed" $tkn_host$
| `cs_user_privilege_mapping(event.UserName)`
| eval cyences_severity = case('event.SeverityName'=="Critical" or is_privileged_user="Yes", "critical", 'event.SeverityName'=="High", "high", 'event.SeverityName'=="Medium", "medium", 'event.SeverityName'=="Low", "low", 'event.SeverityName'=="Informational" or 'event.SeverityName'=="Info", "info", 1==1, "medium") , Description = coalesce('event.DetectDesciption','event.Description'), DetectionName = coalesce('event.DetectName','event.Name'), ComputerName = coalesce('event.Hostname','event.ComputerName')
| `cs_human_readable_time_format(_time, event_time)`
| table event_time, metadata.eventType, ComputerName, action, event.LocalIP, event.UserName, Description, DetectionName, event.CommandLine, event.MD5String, event.SHA256String, event.ProcessId, event.PatternDispositionDescription, event.ParentCommandLine, event.Objective, event.DetectId, event.FalconHostLink, event.SeverityName, cyences_severity, event.Tactic, event.Technique, event.ProcessStartTime, event.ProcessEndTime, is_privileged_user
| rename event.* as * , metadata.* as *
| `cs_human_readable_time_format(ProcessStartTime)` | `cs_human_readable_time_format(ProcessEndTime)`
| `cs_crowdstrike_malware_detected_alert_filter`</query>
          <earliest>$timeRange.earliest$</earliest>
          <latest>$timeRange.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title>Suspicious Activity or Malware Prevented</title>
      <table>
        <search>
          <query>`cs_crowdstrike_eventstream` "metadata.eventType" IN ("DetectionSummaryEvent","EppDetectionSummaryEvent") action="blocked"
| `cs_user_privilege_mapping(event.UserName)`
| eval cyences_severity = case('event.SeverityName'=="Critical" or is_privileged_user="Yes", "critical", 'event.SeverityName'=="High", "high", 'event.SeverityName'=="Medium", "medium", 'event.SeverityName'=="Low", "low", 'event.SeverityName'=="Informational" or 'event.SeverityName'=="Info", "info", 1==1, "medium") , Description = coalesce('event.DetectDesciption','event.Description'), DetectionName = coalesce('event.DetectName','event.Name'), ComputerName = coalesce('event.Hostname','event.ComputerName')
| search $tkn_host$
| `cs_human_readable_time_format(_time, event_time)`
| table event_time, metadata.eventType, ComputerName, action, event.LocalIP, event.UserName, Description, DetectionName, event.CommandLine, event.MD5String, event.SHA256String, event.ProcessId, event.PatternDispositionDescription, event.ParentCommandLine, event.Objective, event.DetectId, event.FalconHostLink, event.SeverityName, cyences_severity, event.Tactic, event.Technique, event.ProcessStartTime, event.ProcessEndTime, is_privileged_user
| rename event.* as * , metadata.* as *
| `cs_human_readable_time_format(ProcessStartTime)` | `cs_human_readable_time_format(ProcessEndTime)`
| `cs_crowdstrike_malware_prevented_filter`</query>
          <earliest>$timeRange.earliest$</earliest>
          <latest>$timeRange.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title>Unauthorized API usage or Activity Detected</title>
      <table>
        <search>
          <query>`cs_crowdstrike_eventstream` "metadata.eventType" IN ("APIActivityAuditEvent","AuthActivityAuditEvent","UserActivityAuditEvent","LoginAuditEvent")
| `cs_user_privilege_mapping(event.UserId)`
| `cs_human_readable_time_format(_time, event_time)`
| table event_time, metadata.eventType, event.OperationName, event.ServiceName, event.Success, event.UserId, event.UserIp, is_privileged_user
| rename event.* as *, metatdata.* as *
| eval cyences_severity = if(is_privileged_user="Yes", "critical","medium")
| `cs_crowdstrike_unauthorized_api_usage_or_activity_detected_alert_filter`</query>
          <earliest>$timeRange.earliest$</earliest>
          <latest>$timeRange.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title>Incident is Reported</title>
      <table>
        <search>
          <query>`cs_crowdstrike_eventstream`  "metadata.eventType" IN ("IncidentSummaryEvent")
| dedup event.IncidentID
| search "event.State"="Open"
| `cs_human_readable_time_format(_time, event_time)`
| `cs_human_readable_time_format(event.IncidentStartTime, IncidentStartTime)`
| table event_time, event.HostID, event.IncidentID, IncidentStartTime, event.FineScore
| rename event.* as *
| eval cyences_severity =  "medium"
| `cs_crowdstrike_incident_is_reported_alert_filter`</query>
          <earliest>$timeRange.earliest$</earliest>
          <latest>$timeRange.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title>Identity Anomalies Detected</title>
      <table>
        <search>
          <query>`cs_crowdstrike_eventstream` "metadata.eventType" IN ("IdentityProtectionEvent")
| `cs_human_readable_time_format(_time, event_time)`
| `cs_user_privilege_mapping(event.UserName)`
| eval cyences_severity = case('event.SeverityName'=="CRITICAL" or is_privileged_user="Yes", "critical", 'event.SeverityName'=="HIGH", "high", 'event.SeverityName'=="MEDIUM", "medium", 'event.SeverityName'=="LOW", "low", 'event.SeverityName'=="INFO", "info", 1==1, "medium")
| table event_time, event.EndpointName, event.IdentityProtectionIncidentId, event.IncidentDescription, event.IncidentType, event.UserName, event.NumberOfCompromisedEntities, event.NumbersOfAlerts, event.SeverityName, cyences_severity, is_privileged_user
| rename event.* as *
| `cs_crowdstrike_identity_anomalies_detected_alert_filter`</query>
          <earliest>$timeRange.earliest$</earliest>
          <latest>$timeRange.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title>DLP Violations Detected</title>
      <table>
        <search>
          <query>`cs_crowdstrike_eventstream` "metadata.eventType" IN ("DataProtectionDetectionSummaryEvent")
| `cs_human_readable_time_format(_time, event_time)`
| `cs_user_privilege_mapping(event.UserName)`
| eval cyences_severity = case('event.SeverityName'=="Critical" or is_privileged_user="Yes", "critical", 'event.SeverityName'=="High", "high", 'event.SeverityName'=="Medium", "medium", 'event.SeverityName'=="Low", "low", 'event.SeverityName'=="Informational", "info", 1==1, "medium")
| table event_time, event.Name, event.Description, event.Hostname, event.UserSid, event.UserName, event.UserTitle, event.UserDepartment, event.Platform, event.DetectionType, event.Tactic, event.Technique event.SeverityName, cyences_severity, is_privileged_user
| rename event.* as *
| `cs_crowdstrike_dlp_violations_detected_alert_filter`</query>
          <earliest>$timeRange.earliest$</earliest>
          <latest>$timeRange.latest$</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
      </table>
    </panel>
  </row>
</form>