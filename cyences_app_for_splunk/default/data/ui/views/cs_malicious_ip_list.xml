<form theme="dark">
  <label>Malicious IP List</label>
  <search id="search_list">
    <query>| inputlookup cs_malicious_ip_list.csv
| addinfo | where (info_min_time="-Infinity" OR last_seen&gt;=info_min_time) AND (info_max_time="+Infinity" OR last_seen&lt;=info_max_time)
| eval last_seen=strftime(last_seen, "%F %T") 
| sort - no_of_victims
| table ip, last_seen, no_of_victims, ip_location, description</query>
    <earliest>$tkn_last_seen.earliest$</earliest>
    <latest>$tkn_last_seen.latest$</latest>
  </search>
  <fieldset submitButton="false">
    <input type="time" token="tkn_last_seen">
      <label>Filter by Last Seen Value</label>
      <default>
        <earliest>-7d@h</earliest>
        <latest>now</latest>
      </default>
    </input>
  </fieldset>
  <row>
    <panel>
      <title>Malicious IPs on Map</title>
      <map>
        <search base="search_list">
          <query>| eval description=case(description="Incoming traffic into multiple firewalls from this blocked IP", "Incoming Traffic from Blocked IP", description="Outgoing traffic through multiple firewalls to this blocked IP", "Outgoing Traffic to Blocked IP", description="Involved in DDoS Attack", "DDoS", 1==1, "Other")
| iplocation ip | geostats globallimit=0 sum(no_of_victims) by description</query>
        </search>
        <option name="drilldown">all</option>
        <option name="mapping.type">marker</option>
        <drilldown>
          <link target="_blank">search?q=%7C%20inputlookup%20cs_malicious_ip_list.csv%0A%7C%20addinfo%20%7C%20where%20(info_min_time=%22-Infinity%22%20OR%20last_seen%3E=info_min_time)%20AND%20(info_max_time=%22+Infinity%22%20OR%20last_seen%3C=info_max_time)%0A%7C%20eval%20last_seen=strftime(last_seen,%20%22%25F%20%25T%22)%20%0A%7C%20sort%20-%20no_of_victims%0A%7C%20table%20ip,%20last_seen,%20no_of_victims,%20ip_location,%20description%20%7C%20%20eval%20description=case(description=%22Incoming%20traffic%20into%20multiple%20firewalls%20from%20this%20blocked%20IP%22,%20%22Incoming%20Traffic%20from%20Blocked%20IP%22,%20description=%22Outgoing%20traffic%20through%20multiple%20firewalls%20to%20this%20blocked%20IP%22,%20%22Outgoing%20Traffic%20to%20Blocked%20IP%22,%20description=%22Involved%20in%20DDoS%20Attack%22,%20%22DDoS%22,%201==1,%20%22Other%22)%0A%7C%20iplocation%20ip%0A%7C%20search%20lat%3E=$click.bounds.south$%20lat%3C$click.bounds.north$%20lon%3E=$click.bounds.west$%20lon%3C$click.bounds.east$&amp;earliest=$tkn_last_seen.earliest$&amp;latest=$tkn_last_seen.latest$</link>
        </drilldown>
      </map>
    </panel>
  </row>
  <row>
    <panel>
      <title>Malicious IP List</title>
      <input type="dropdown" token="tkn_ip">
        <label>Search Bad IP</label>
        <choice value="*">All</choice>
        <fieldForLabel>ip</fieldForLabel>
        <fieldForValue>ip</fieldForValue>
        <search base="search_list">
          <query>| fields ip</query>
        </search>
        <default>*</default>
      </input>
      <table>
        <search base="search_list">
          <query>| search ip=$tkn_ip|s$</query>
        </search>
        <option name="count">20</option>
        <option name="drilldown">none</option>
        <option name="rowNumbers">true</option>
      </table>
      <html>
        <p>Description: This is the list that is generated by "PaloAlto Firewall - Malicious IP List Gen" report. (Make sure that this report is enabled.) Refer to the report for more details.</p>
        <p>By default list contains IP addresses discovered in last 7 days. To change the time update the macro definition for `cs_palo_malicious_ip_list_filter_old_results`.</p>
      </html>
    </panel>
  </row>
</form>