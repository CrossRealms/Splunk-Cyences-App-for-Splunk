<form theme="dark">
  <label>Splunk Admin</label>
  <search id="indexes_search">
    <query>| inputlookup cs_indexes.csv
| eval last_event=strftime(last_event, "%F %T")
| table index, last_event, hosts, sourcetypes, status</query>
    <earliest>0</earliest>
    <latest></latest>
    <sampleRatio>1</sampleRatio>
  </search>
  <search id="forwarders_search">
    <query>| inputlookup cs_forwarders.csv
| eval last_connected=strftime(last_connected, "%F %T")
| table hostname, forwarder_type, version, last_connected, os, arch, status</query>
    <earliest>0</earliest>
    <latest></latest>
    <sampleRatio>1</sampleRatio>
  </search>
  <search id="base_search">
    <query>| rest splunk_server=* /services/server/status/partitions-space 
  | eval free = if(isnotnull(available), available, free) 
  | eval usage = round((capacity - free) / 1024, 2) 
  | eval capacity = round(capacity / 1024, 2) 
  | eval compare_usage = usage." / ".capacity 
  | eval pct_usage = round(usage / capacity * 100, 2) 
  | stats first(fs_type) as fs_type first(compare_usage) as compare_usage first(pct_usage) as pct_usage, by mount_point splunk_server 
  | sort - pct_usage 
  | table splunk_server mount_point,compare_usage,pct_usage 
    </query>
    <earliest>-24h@h</earliest>
    <latest>now</latest>
  </search>
  <fieldset submitButton="false"></fieldset>
  <row>
    <panel>
      <html>
        <p>Splunk Admin Reports</p>
        <p>Shows information which is important for security and overall health of the Splunk environment.</p>
        <p>Alerts "Splunk Admin - Missing Data in the Index" and "Splunk Admin - Missing Forwarder" has to be enabled in order to populate this dashboard.</p>
      </html>
      <table>
        <search>
          <query>| rest /servicesNS/-/cyences_app_for_splunk/saved/searches count=0 splunk_server=local | search "eai:acl.app"="cyences_app_for_splunk" title IN ("Splunk Admin - Missing Data in the Index", "Splunk Admin - Missing Forwarder") | fields title, disabled | eval data=if(disabled=1, "Alert is disabled", "Alert is enabled") | rename title as label | table label, data</query>
          <earliest>0</earliest>
          <latest></latest>
        </search>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
        <format type="color" field="data">
          <colorPalette type="map">{"Alert is enabled": #03991a, "Alert is disabled": #a3030b}</colorPalette>
        </format>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title>Indexes</title>
      <input type="text" token="tkn_index">
        <label>Index</label>
        <default>*</default>
      </input>
      <input type="dropdown" token="tkn_indexes_status">
        <label>Status</label>
        <choice value="*">All</choice>
        <default>*</default>
        <fieldForLabel>status</fieldForLabel>
        <fieldForValue>status</fieldForValue>
        <search base="indexes_search">
          <query>dedup status | fields status</query>
        </search>
      </input>
      <table>
        <search base="indexes_search">
          <query>search index=$tkn_index|s$ status=$tkn_indexes_status|s$</query>
        </search>
        <option name="drilldown">row</option>
        <option name="rowNumbers">true</option>
        <drilldown>
          <link target="_blank">search?q=index=$click.value|s$%20%7C%20timechart%20span=1h%20count&amp;earliest=-24h@h&amp;latest=now&amp;display.page.search.tab=visualizations&amp;display.general.type=visualizations&amp;display.visualizations.type=charting&amp;display.page.search.mode=fast</link>
        </drilldown>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title>Forwarders</title>
      <input type="text" token="tkn_forwarder">
        <label>Forwarder</label>
        <default>*</default>
      </input>
      <input type="dropdown" token="tkn_forwarders_status">
        <label>Status</label>
        <choice value="*">All</choice>
        <default>*</default>
        <fieldForLabel>status</fieldForLabel>
        <fieldForValue>status</fieldForValue>
        <search base="forwarders_search">
          <query>dedup status | fields status</query>
        </search>
      </input>
      <input type="dropdown" token="tkn_forwarders_version">
        <label>Splunk Version</label>
        <choice value="*">All</choice>
        <default>*</default>
        <fieldForLabel>version</fieldForLabel>
        <fieldForValue>version</fieldForValue>
        <search base="forwarders_search">
          <query>dedup version | fields version</query>
        </search>
      </input>
      <input type="dropdown" token="tkn_forwarders_os">
        <label>OS</label>
        <choice value="*">All</choice>
        <default>*</default>
        <fieldForLabel>os</fieldForLabel>
        <fieldForValue>os</fieldForValue>
        <search base="forwarders_search">
          <query>dedup os | fields os</query>
        </search>
      </input>
      <input type="dropdown" token="tkn_forwarders_arch">
        <label>CPU Architecture</label>
        <choice value="*">All</choice>
        <default>*</default>
        <fieldForLabel>arch</fieldForLabel>
        <fieldForValue>arch</fieldForValue>
        <search base="forwarders_search">
          <query>dedup arch | fields arch</query>
        </search>
      </input>
      <table>
        <search base="forwarders_search">
          <query>search hostname=$tkn_forwarder|s$ status=$tkn_forwarders_status|s$ version=$tkn_forwarders_version|s$ os=$tkn_forwarders_os|s$ arch=$tkn_forwarders_arch$</query>
        </search>
        <option name="drilldown">none</option>
        <option name="rowNumbers">true</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title>Disk Statistics</title>
      <input type="dropdown" token="host">
        <label>Host</label>
        <choice value="*">All</choice>
        <fieldForLabel>Host</fieldForLabel>
        <fieldForValue>Host</fieldForValue>
        <search base="base_search">
          <query>| fields splunk_server | rename splunk_server as Host | dedup Host</query>
        </search>
        <default>*</default>
        <initialValue>*</initialValue>
      </input>
      <input type="dropdown" token="disk_usage" searchWhenChanged="true">
        <label>Disk Usage</label>
        <choice value="&gt;0">All</choice>
        <choice value="&gt;80">&gt; 80</choice>
        <choice value="&gt;60">&gt;60</choice>
        <default>&gt;0</default>
        <initialValue>&gt;0</initialValue>
      </input>
      <table>
        <search base="base_search">
          <query>| search splunk_server=$host$ AND pct_usage$disk_usage$| rename mount_point as "Mount Point", compare_usage as "Disk Usage (GB)", capacity as "Capacity (GB)", pct_usage as "Disk Usage (%)", splunk_server as Host | search Host=$host$</query>
        </search>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
        <format type="color" field="Disk Usage (%)">
          <colorPalette type="list">[#3C444D,#F8BE34,#DC4E41]</colorPalette>
          <scale type="threshold">60,80</scale>
        </format>
      </table>
    </panel>
  </row>
</form>
