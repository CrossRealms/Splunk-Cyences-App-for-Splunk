---
layout: default
title: Antivirus / Antimalware
permalink: /configuration/data_onboarding/antivirus_antimalware/
nav_order: 4
parent: Data Onboarding
grand_parent: Configuration
has_children: true
---

# **Antivirus / Antimalware** 

## **CrowdStrike Event Streams Logs**

In order to collect CrowdStrike's Event Streams logs, the [CrowdStrike Falcon Event Streams Technical Add-On](https://splunkbase.splunk.com/app/5082/) is required for data parsing and field extraction. 

There are two main components that need to be configured for the CrowdStrike Add-on: 

1. Add Account: 

    ![alt](https://github.com/CrossRealms/Splunk-Cyences-App-for-Splunk/blob/master/docs/assets/crowdstrike_config_add_account.png?raw=true)

2. Create New Input: 

    ![alt](https://github.com/CrossRealms/Splunk-Cyences-App-for-Splunk/blob/master/docs/assets/crowdstrike_config_new_input.png?raw=true)

3. Refer to the [CrowdStrike Resource Center: CrowdStrike Falcon Event Streams Add-On Guide](https://www.crowdstrike.com/resources/guides/how-to-install-falcon-event-streams-splunk-add-on/) for the Add-on's configuration steps.


## **Kaspersky Logs**

Use the following Add-on to collect the data from Kaspersky. 

Splunkbase Download: 
[https://splunkbase.splunk.com/app/4656/](https://splunkbase.splunk.com/app/4656/)   

Installation Guide: 
[https://splunkbase.splunk.com/app/4656/#/details](https://splunkbase.splunk.com/app/4656/#/details) 

## Estimated Data Size
The Kaspersky data is not large in terms of license and storage usage but it depends on the number of hosts connected in Kaspersky.


## **Microsoft 365 Defender ATP**

The Microsoft 365 Defender Add-on for Splunk will be used to collect Windows Defender ATP alert logs. 

Splunkbase Download: 
[https://splunkbase.splunk.com/app/4959/](https://splunkbase.splunk.com/app/4959/) 

Installation and Configuration Guide: 
[https://splunkbase.splunk.com/app/4959/#/details](https://splunkbase.splunk.com/app/4959/#/details) 

**Note:** Use index=**defenderatp** for data collection or update the macro definition for `cs_o365_defender_atp` (**Settings > Configuration**).

## Collect Defender ATP Configuration Status Logs from Windows Servers 

The Defender ATP Status Check Add-On will be used to collect Defender ATP Configuration Status check logs. 

Splunkbase Download: 
[https://splunkbase.splunk.com/app/5691](https://splunkbase.splunk.com/app/5691) 

Installation and Configuration Guide: 
[https://splunkbase.splunk.com/app/5691/#/details](https://splunkbase.splunk.com/app/5691/#/details) 

Install the Defender ATP Status Check Add-On on a heavy forwarder and universal forwarders (Windows).

Add the following stanza to inputs.conf in the local directory for the **TA-defender-atp-status-check** add-on:

    [powershell://generate_defender_atp_status_logs] 
    disabled = 0 

    [monitor://$SPLUNK_HOME\var\log\TA-defender-atp-status-check \DefenderATPStatus.log] 
    disabled = 0 
    index = defenderatp 

**Note:** Use index=defenderatp for data collection or update the macro definition for `cs_o365_defender_atp_audit` (**Settings > Configuration**).

## Audit Defender ATP Configuration Status 

Use the Microsoft Defender ATP Audit dashboard (**Settings > Microsoft 365 Defender ATP**) to audit the configuration status for Defender ATP.


## **Sophos Central Events**

The Sophos Central Splunk Add-on is required to collect Sophos Central data. 

Splunkbase Download:
[https://splunkbase.splunk.com/app/4647/](https://splunkbase.splunk.com/app/4647/) 
 
Installation and Configuration Guide:
[https://splunkbase.splunk.com/app/4647/#/details](https://splunkbase.splunk.com/app/4647/#/details) 

## How to Install and Configure the Sophos Central Add-on: 

1. Install the Add-on on the Heavy Forwarder. 

2. Configure the Add-on on the Heavy Forwarder. 
    * Configure the Application. 
    * Create an index named **Sophos** or update the macro definition in the Cyences app (**Settings > Configuration**). 

3. Install the Add-on on the Search Head. 

## Estimated Data Size  
The Sophos Central Add-on consumes around 60-80MB of license usage per day. 

The total amount of data varies based on the size of your organization (our calculations are based on organizations with around thirty users and a few workstations). 

## **Sophos Central Metadata through API**
Cyences version 1.6 utilizes Sophos Central API to collect information about Sophos endpoints. The Sophos Central API data is being used in a number of places throughout the Cyences app, including the Device Inventory dashboard. 

## Sophos Central API Configuration

1. Login to Sophos Central Parner portal. 

2. Click **Settings & Policies**. 

3. Click on the **API Credentials link**.

4. Add a new set of credentials. 

5. Provide a name and description for your credential set, then click **Add**. 

6. Click the **Copy** button at the end of the Client ID.  

7. Click **Show Client Secret**. 

8. Refer to the Sophos Central documentation link below for further assistance.  
    *[https://developer.sophos.com/getting-started](https://developer.sophos.com/getting-started) 

## Sophos Central API Configuration for Cyences  

1. From Cyences' navigation bar, go to **Settings > Configuration**. 

2. Enter the Client ID and Client Secret for **Sophos Endpoint API Configuration**.

3. Click **Save**.

    ![alt](https://github.com/CrossRealms/Splunk-Cyences-App-for-Splunk/blob/master/docs/assets/sophos_endpoint_api_config.png?raw=true)

## How to verify the Sophos Central API configuration: 

1. From Cyences' navigation bar, click **Search**.

2. Run the following search query: 
    
        | sophosinstancedetails all_endpoints=True 

3. If the search results return/s any errors, then there is something wrong with the configuration. 

4. A successful configuration will display the total number of events with no errors.  

    ![alt](https://github.com/CrossRealms/Splunk-Cyences-App-for-Splunk/blob/master/docs/assets/sophos_endpoint_api_config.png?raw=true)

## Estimated Data Size
Data collected from Sophos will be stored in a KV Store lookup, so it will not affect your Splunk license. 


## **Windows Defender**

To collect the Windows defender data, we'll be using below input stanza to collect the data. This data collection requires [TA for Microsoft Windows Defender](https://splunkbase.splunk.com/app/3734/) for data parsing and field extraction. 

Enable the input stanzas below for the Microsoft Windows Defender TA. Both stanzas are located in the inputs.conf file (create a local directory if necessary): 

    [WinEventLog://Microsoft-Windows-Windows Defender/Operational] 
    index = windefender 
    disabled = 0 
    renderXml = 1 

**Note:** Windows Defender logs are only tested in XML format (see renderXml = 1 in inputs.conf stanza).

## Estimated Data Size
The estimated data size depends on the number of hosts that are sending Windows Defender data. 

* Events: 150-300 per Windows machine (daily) 
* Licensing: < 5MB per Windows machine (daily)